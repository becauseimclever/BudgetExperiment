@* AccountForm.razor - Reusable account create/edit form *@

<form @onsubmit="HandleSubmit">
    <div class="form-group">
        <label class="form-label">Scope:</label>
        <div class="scope-radio-group">
            <label class="scope-radio @(Model.Scope == "Shared" ? "selected" : "")">
                <input type="radio" name="scope" value="Shared" checked="@(Model.Scope == "Shared")" @onchange="@(() => Model.Scope = "Shared")" />
                <span class="scope-radio-icon"><Icon Name="home" Size="18" /></span>
                <span class="scope-radio-text">Shared</span>
            </label>
            <label class="scope-radio @(Model.Scope == "Personal" ? "selected" : "")">
                <input type="radio" name="scope" value="Personal" checked="@(Model.Scope == "Personal")" @onchange="@(() => Model.Scope = "Personal")" />
                <span class="scope-radio-icon"><Icon Name="user" Size="18" /></span>
                <span class="scope-radio-text">Personal</span>
            </label>
        </div>
        <p class="form-hint">
            @if (Model.Scope == "Shared")
            {
                <text>Shared accounts are visible to all family members.</text>
            }
            else
            {
                <text>Personal accounts are private to you.</text>
            }
        </p>
    </div>

    <div class="form-group">
        <label for="accountName" class="form-label">Account Name:</label>
        <input id="accountName" 
               type="text"
               class="form-control"
               @bind="Model.Name" 
               @bind:event="oninput"
               placeholder="Enter account name"
               required />
    </div>
    <div class="form-group">
        <label for="accountType" class="form-label">Account Type:</label>
        <select id="accountType" class="form-control" @bind="Model.Type" required>
            <option value="Checking">Checking</option>
            <option value="Savings">Savings</option>
            <option value="CreditCard">Credit Card</option>
            <option value="Cash">Cash</option>
            <option value="Other">Other</option>
        </select>
    </div>
    
    <fieldset class="form-fieldset">
        <legend>Starting Balance</legend>
        <div class="form-group">
            <label for="initialBalance" class="form-label">Initial Balance:</label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <input id="initialBalance" 
                       type="number" 
                       class="form-control"
                       step="0.01"
                       @bind="Model.InitialBalance" 
                       @bind:event="oninput"
                       placeholder="0.00" />
            </div>
        </div>
        <div class="form-group">
            <label for="initialBalanceDate" class="form-label">As of Date:</label>
            <input id="initialBalanceDate" 
                   type="date"
                   class="form-control"
                   @bind="InitialBalanceDateValue" />
        </div>
    </fieldset>
    
    <div class="form-actions form-actions-right">
        <button type="button" class="btn btn-secondary" @onclick="HandleCancel" disabled="@IsSubmitting">
            Cancel
        </button>
        <button type="submit" class="btn btn-primary" disabled="@IsSubmitting">
            @if (IsSubmitting)
            {
                <span>Saving...</span>
            }
            else
            {
                <span>@SubmitButtonText</span>
            }
        </button>
    </div>
</form>

@code {
    /// <summary>
    /// Gets or sets the account model to edit.
    /// </summary>
    [Parameter]
    public AccountCreateDto Model { get; set; } = new();

    /// <summary>
    /// Gets or sets the callback when the form is submitted.
    /// </summary>
    [Parameter]
    public EventCallback<AccountCreateDto> OnSubmit { get; set; }

    /// <summary>
    /// Gets or sets the callback when cancel is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnCancel { get; set; }

    /// <summary>
    /// Gets or sets the submit button text.
    /// </summary>
    [Parameter]
    public string SubmitButtonText { get; set; } = "Save";

    /// <summary>
    /// Gets or sets a value indicating whether the form is submitting.
    /// </summary>
    [Parameter]
    public bool IsSubmitting { get; set; }

    private DateTime InitialBalanceDateValue
    {
        get => Model.InitialBalanceDate?.ToDateTime(TimeOnly.MinValue) ?? DateTime.Today;
        set => Model.InitialBalanceDate = DateOnly.FromDateTime(value);
    }

    protected override void OnInitialized()
    {
        // Set default date if not already set
        Model.InitialBalanceDate ??= DateOnly.FromDateTime(DateTime.Today);
    }

    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(Model.Name))
        {
            return;
        }

        await OnSubmit.InvokeAsync(Model);
    }

    private async Task HandleCancel()
    {
        await OnCancel.InvokeAsync();
    }
}
