@* AccountForm.razor - Reusable account create/edit form *@

<form @onsubmit="HandleSubmit">
    <div class="form-group">
        <label for="accountName">Account Name:</label>
        <input id="accountName" 
               type="text" 
               @bind="Model.Name" 
               @bind:event="oninput"
               placeholder="Enter account name"
               required />
    </div>
    <div class="form-group">
        <label for="accountType">Account Type:</label>
        <select id="accountType" @bind="Model.Type" required>
            <option value="Checking">Checking</option>
            <option value="Savings">Savings</option>
            <option value="CreditCard">Credit Card</option>
            <option value="Cash">Cash</option>
            <option value="Other">Other</option>
        </select>
    </div>
    
    <fieldset class="balance-section">
        <legend>Starting Balance</legend>
        <div class="form-group">
            <label for="initialBalance">Initial Balance:</label>
            <div class="currency-input">
                <span class="currency-symbol">$</span>
                <input id="initialBalance" 
                       type="number" 
                       step="0.01"
                       @bind="Model.InitialBalance" 
                       @bind:event="oninput"
                       placeholder="0.00" />
            </div>
        </div>
        <div class="form-group">
            <label for="initialBalanceDate">As of Date:</label>
            <input id="initialBalanceDate" 
                   type="date" 
                   @bind="InitialBalanceDateValue" />
        </div>
    </fieldset>
    
    <div class="form-actions">
        <button type="submit" class="btn-primary" disabled="@IsSubmitting">
            @if (IsSubmitting)
            {
                <span>Saving...</span>
            }
            else
            {
                <span>@SubmitButtonText</span>
            }
        </button>
        <button type="button" class="btn-secondary" @onclick="HandleCancel" disabled="@IsSubmitting">
            Cancel
        </button>
    </div>
</form>

@code {
    /// <summary>
    /// Gets or sets the account model to edit.
    /// </summary>
    [Parameter]
    public AccountCreateDto Model { get; set; } = new();

    /// <summary>
    /// Gets or sets the callback when the form is submitted.
    /// </summary>
    [Parameter]
    public EventCallback<AccountCreateDto> OnSubmit { get; set; }

    /// <summary>
    /// Gets or sets the callback when cancel is clicked.
    /// </summary>
    [Parameter]
    public EventCallback OnCancel { get; set; }

    /// <summary>
    /// Gets or sets the submit button text.
    /// </summary>
    [Parameter]
    public string SubmitButtonText { get; set; } = "Save";

    /// <summary>
    /// Gets or sets a value indicating whether the form is submitting.
    /// </summary>
    [Parameter]
    public bool IsSubmitting { get; set; }

    private DateTime InitialBalanceDateValue
    {
        get => Model.InitialBalanceDate?.ToDateTime(TimeOnly.MinValue) ?? DateTime.Today;
        set => Model.InitialBalanceDate = DateOnly.FromDateTime(value);
    }

    protected override void OnInitialized()
    {
        // Set default date if not already set
        Model.InitialBalanceDate ??= DateOnly.FromDateTime(DateTime.Today);
    }

    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(Model.Name))
        {
            return;
        }

        await OnSubmit.InvokeAsync(Model);
    }

    private async Task HandleCancel()
    {
        await OnCancel.InvokeAsync();
    }
}
