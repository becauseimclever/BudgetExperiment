@* BarChart.razor - Pure SVG bar chart rendered by Blazor *@

<div class="bar-chart-container">
    @if (!Groups.Any())
    {
        <div class="bar-chart-empty" role="img" aria-label="@AriaLabel">
            <p>No data to display</p>
        </div>
    }
    else
    {
        <div class="bar-chart-wrapper">
            <svg viewBox="0 0 @F(ComputedViewBoxWidth) @F(ViewBoxHeight)"
                 class="bar-chart"
                 role="img"
                 aria-label="@AriaLabel"
                 preserveAspectRatio="xMidYMid meet">
                <title>@AriaLabel</title>

                @* Y-axis grid lines and labels *@
                @foreach (var tick in ComputedYTicks)
                {
                    <line x1="@F(MarginLeft)"
                          y1="@F(tick.Y)"
                          x2="@F(ComputedViewBoxWidth - MarginRight)"
                          y2="@F(tick.Y)"
                          class="grid-line"
                          stroke="var(--chart-grid-color, #e5e7eb)"
                          stroke-width="0.5"
                          stroke-dasharray="2,2" />
                    @RenderSvgText(MarginLeft - 4, tick.Y + 3, "axis-label", "end", "8", tick.Label)
                }

                @* X-axis baseline *@
                <line x1="@F(MarginLeft)"
                      y1="@F(ChartAreaBottom)"
                      x2="@F(ComputedViewBoxWidth - MarginRight)"
                      y2="@F(ChartAreaBottom)"
                      stroke="var(--chart-axis-color, #9ca3af)"
                      stroke-width="1" />

                @* Bars *@
                @foreach (var bar in ComputedBars)
                {
                    @RenderSvgText(bar.LabelX, ChartAreaBottom + 14, "axis-label x-axis-label", "middle", "7", bar.GroupLabel)

                    @foreach (var rect in bar.Rects)
                    {
                        <rect x="@F(rect.X)"
                              y="@F(rect.Y)"
                              width="@F(rect.Width)"
                              height="@F(rect.Height)"
                              fill="@rect.Color"
                              rx="1.5"
                              ry="1.5"
                              class="bar-rect"
                              role="img"
                              tabindex="0"
                              @onfocusin="() => HandleBarHover(rect.GroupLabel, rect.SeriesName, rect.Value)"
                              @onfocusout="HandleBarHoverEnd"
                              @onmouseenter="() => HandleBarHover(rect.GroupLabel, rect.SeriesName, rect.Value)"
                              @onmouseleave="HandleBarHoverEnd"
                              @onclick="() => HandleBarClick(rect)"
                              aria-label="@rect.AriaLabel" />
                    }
                }
            </svg>
        </div>

        @* Legend *@
        @if (ShowLegend && Series.Any())
        {
            <div class="bar-chart-legend" role="list" aria-label="Chart legend">
                @foreach (var s in Series)
                {
                    <div class="legend-item" role="listitem">
                        <span class="legend-swatch" style="background-color: @s.Color" aria-hidden="true"></span>
                        <span class="legend-label">@s.Name</span>
                    </div>
                }
            </div>
        }

        @* Tooltip *@
        @if (HoveredSeriesName is not null)
        {
            <div class="bar-tooltip" style="opacity: 1;">
                <div class="tooltip-label">@HoveredGroupLabel</div>
                <div class="tooltip-series">@HoveredSeriesName</div>
                <div class="tooltip-value">@FormatMoney(HoveredValue)</div>
            </div>
        }
    }
</div>
