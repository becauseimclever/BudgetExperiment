# Feature 024.3: Fix Transaction Category Display Bug

## Status: Complete âœ“

## Problem Statement

The transactions table (Account Transactions page) displays category IDs (GUIDs) instead of category names. Users see values like `b08c5eb2` instead of "Groceries" or "Entertainment".

### Observed Behavior

In the transactions list, the Category column shows:
```
Date         | Description                  | Category  | Amount
Jan 17, 2026 | WALMART SUPERCENTER #1234    | b08c5eb2  | -$75.50
Jan 15, 2026 | Weekly groceries             | b08c5eb2  | -$85.00
Jan 14, 2026 | Movie night                  | 8d6dd464  | -$45.00
```

### Expected Behavior

The Category column should show human-readable category names:
```
Date         | Description                  | Category      | Amount
Jan 17, 2026 | WALMART SUPERCENTER #1234    | Groceries     | -$75.50
Jan 15, 2026 | Weekly groceries             | Groceries     | -$85.00
Jan 14, 2026 | Movie night                  | Entertainment | -$45.00
```

## Root Cause Analysis

The issue is likely one of:
1. **API Response**: The API returns `CategoryId` but not `CategoryName`
2. **Client Binding**: The client displays `CategoryId` instead of looking up the name
3. **DTO Mapping**: The TransactionDto doesn't include category name

## Implementation Phases

### Phase 1: Investigation
- [ ] Check TransactionDto - does it include CategoryName?
- [ ] Check API response for transaction endpoints
- [ ] Check client component binding for category column
- [ ] Write failing test if applicable

### Phase 2: Fix (depends on root cause)

#### Option A: API already returns CategoryName
- [ ] Fix client component to display `CategoryName` instead of `CategoryId`

#### Option B: API doesn't return CategoryName
- [ ] Update TransactionDto to include `CategoryName`
- [ ] Update transaction query to join/include category name
- [ ] Update client component to display `CategoryName`

### Phase 3: Verification
- [ ] Verify category names display correctly
- [ ] Verify uncategorized transactions show "-" or "None"
- [ ] Test on Calendar page transaction list
- [ ] Test on Account Transactions page

## Affected Pages

- [ ] Account Transactions page (`/accounts/{id}/transactions`)
- [ ] Calendar page transaction details (if applicable)
- [ ] Any other page displaying transaction lists

## Technical Notes

### TransactionDto Check

Current DTO likely has:
```csharp
public Guid? CategoryId { get; set; }
// Missing: public string? CategoryName { get; set; }
```

Should have:
```csharp
public Guid? CategoryId { get; set; }
public string? CategoryName { get; set; }
```

### Client Component Check

Current binding might be:
```razor
<td>@transaction.CategoryId</td>
```

Should be:
```razor
<td>@(transaction.CategoryName ?? "-")</td>
```

## Acceptance Criteria

- [x] Category names display correctly in transaction lists
- [x] Uncategorized transactions show "-" or appropriate placeholder
- [x] All transaction list views updated consistently
- [x] No performance regression from additional data (single JOIN added)

## Implementation Summary

### Changes Made

**Domain Layer:**
- Added `Category` navigation property to `Transaction` entity
- Added `Category` navigation property to `RecurringTransaction` entity

**Contracts Layer:**
- Added `CategoryName` property to `TransactionDto`
- Added `CategoryName` property to `RecurringInstanceDto`

**Application Layer:**
- Updated `DomainToDtoMapper.ToDto(Transaction)` to include `CategoryName`
- Updated `DomainToDtoMapper.ToInstanceDto(RecurringTransaction, ...)` to include `CategoryName`

**Infrastructure Layer:**
- Updated `TransactionRepository` - added `.Include(t => t.Category)` to all query methods
- Updated `RecurringTransactionRepository` - added `.Include(r => r.Category)` to all query methods

**Client Layer:**
- Added `CategoryName` property to `TransactionListItem`
- Updated `FromTransaction()` and `FromRecurringInstance()` methods to copy `CategoryName`
- Updated `TransactionTable.razor` to display `CategoryName ?? "-"` instead of `CategoryId`

### Files Modified

- `src/BudgetExperiment.Domain/Transaction.cs`
- `src/BudgetExperiment.Domain/RecurringTransaction.cs`
- `src/BudgetExperiment.Contracts/Dtos/TransactionDto.cs`
- `src/BudgetExperiment.Contracts/Dtos/RecurringTransactionDto.cs`
- `src/BudgetExperiment.Application/Mapping/DomainToDtoMapper.cs`
- `src/BudgetExperiment.Infrastructure/Repositories/TransactionRepository.cs`
- `src/BudgetExperiment.Infrastructure/Repositories/RecurringTransactionRepository.cs`
- `src/BudgetExperiment.Client/Models/TransactionListItem.cs`
- `src/BudgetExperiment.Client/Components/Display/TransactionTable.razor`

## Priority

**Medium** - This was a UX issue that affected usability but didn't block functionality.

## Discovered

Found during manual testing of Feature 024 (Categorization Rules) on January 17, 2026.

## Resolution

Fixed on January 17, 2026 by adding Category navigation properties and CategoryName to DTOs.
