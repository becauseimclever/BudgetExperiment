# Feature 024.4: Playwright End-to-End Tests

## Status: In Progress ðŸ”„

## Overview

Implement comprehensive end-to-end (E2E) tests using Playwright for .NET to verify critical user journeys in the Budget Experiment application. These tests will run against the local development server, providing automated verification of UI functionality that was previously validated through manual testing.

## Problem Statement

### Current State

Manual UI testing has been valuable for discovering bugs and verifying user workflows, but it is:
- Time-consuming to repeat after each code change
- Prone to human error and inconsistency
- Not integrated into the CI/CD pipeline
- Difficult to track coverage of tested scenarios

### Target State

Automated Playwright tests that:
- Run against the local development server (http://localhost:5099)
- Cover critical user journeys (navigation, CRUD operations, form validation)
- Provide consistent, repeatable verification
- Can be integrated into CI/CD pipeline in the future
- Document expected UI behavior through test cases

---

## User Stories

### Test Infrastructure

#### US-024.4-001: Local Server Integration
**As a** developer  
**I want** E2E tests to automatically use the running local server  
**So that** I can run tests against my current development state

**Acceptance Criteria:**
- [ ] Tests connect to http://localhost:5099
- [ ] Clear error message if server is not running
- [ ] Tests can be run with `dotnet test` command

#### US-024.4-002: Page Object Model
**As a** developer  
**I want** page objects for each main page  
**So that** tests are maintainable and readable

**Acceptance Criteria:**
- [ ] Page objects encapsulate page interactions
- [ ] Common elements (navigation, modals) are shared
- [ ] Locators use data-testid attributes where needed

### Core Workflow Tests

#### US-024.4-003: Navigation Tests
**As a** developer  
**I want** tests that verify all navigation links work  
**So that** users can always access all pages

**Acceptance Criteria:**
- [ ] All sidebar navigation links are tested
- [ ] Page titles verify correct page loaded
- [ ] Back/forward browser navigation works

#### US-024.4-004: Account Management Tests
**As a** developer  
**I want** tests for account CRUD operations  
**So that** account management is verified

**Acceptance Criteria:**
- [ ] Create account with valid data
- [ ] Edit existing account
- [ ] Delete account
- [ ] View account transactions

#### US-024.4-005: Transaction Management Tests
**As a** developer  
**I want** tests for transaction workflows  
**So that** core functionality is verified

**Acceptance Criteria:**
- [ ] Add transaction manually
- [ ] Edit transaction
- [ ] Delete transaction
- [ ] Categorize transaction
- [ ] Import transactions from CSV

---

## Technical Design

### Project Structure

```
tests/
  BudgetExperiment.E2E.Tests/
    BudgetExperiment.E2E.Tests.csproj
    playwright.config.json (if needed)
    GlobalUsings.cs
    Infrastructure/
      PlaywrightFixture.cs       # Test fixture with browser setup
      TestServerHelper.cs        # Server connectivity checks
    PageObjects/
      BasePage.cs                # Common page functionality
      NavigationComponent.cs     # Sidebar navigation
      ModalComponent.cs          # Modal dialog interactions
      AccountsPage.cs
      AccountTransactionsPage.cs
      BudgetPage.cs
      CalendarPage.cs
      CategoriesPage.cs
      RecurringPage.cs
      RulesPage.cs
      SettingsPage.cs
    Tests/
      NavigationTests.cs
      AccountsTests.cs
      TransactionsTests.cs
      BudgetTests.cs
      CategoriesTests.cs
```

### Technology Stack

- **Playwright for .NET** (`Microsoft.Playwright`)
- **xUnit** for test framework (consistent with other test projects)
- **Page Object Model** pattern for maintainability

### Configuration

Tests will default to `http://localhost:5099` but allow override via environment variable:
```bash
BUDGET_APP_URL=http://localhost:5099
```

### Test Data Strategy

1. **Isolated Tests**: Each test should clean up its own data
2. **Unique Naming**: Use timestamps/GUIDs in created entities to avoid conflicts
3. **Scope Separation**: Use Personal scope for test isolation

---

## Implementation Plan

### Phase 1: Project Setup

**Objective:** Create E2E test project with Playwright and basic infrastructure

**Tasks:**
- [x] Create `BudgetExperiment.E2E.Tests.csproj` with Playwright packages
- [x] Add project to solution
- [x] Create `PlaywrightFixture.cs` for browser setup
- [x] Create `BasePage.cs` with common functionality
- [x] Add initial smoke test to verify setup

**Commit:**
```bash
git add .
git commit -m "test(e2e): add Playwright E2E test project infrastructure

- Add BudgetExperiment.E2E.Tests project with Playwright
- Create PlaywrightFixture for browser lifecycle
- Add BasePage for page object pattern
- Add smoke test for setup verification

Refs: #024.4"
```

### Phase 2: Navigation Page Objects & Tests

**Objective:** Create navigation tests and sidebar component

**Tasks:**
- [ ] Create `NavigationComponent.cs` for sidebar
- [ ] Create page objects for each page
- [ ] Write navigation tests for all routes
- [ ] Verify page titles and content

### Phase 3: Account CRUD Tests

**Objective:** Test account management workflows

**Tasks:**
- [ ] Create `AccountsPage.cs` page object
- [ ] Create `ModalComponent.cs` for dialogs
- [ ] Write create account test
- [ ] Write edit account test
- [ ] Write delete account test

### Phase 4: Transaction Tests

**Objective:** Test transaction management

**Tasks:**
- [ ] Create `AccountTransactionsPage.cs` page object
- [ ] Write add transaction test
- [ ] Write edit transaction test
- [ ] Write delete transaction test
- [ ] Write categorization test

### Phase 5: Budget & Categories Tests

**Objective:** Test budget overview and category management

**Tasks:**
- [ ] Create `BudgetPage.cs` and `CategoriesPage.cs`
- [ ] Write budget navigation tests
- [ ] Write category CRUD tests
- [ ] Write budget goal tests

---

## Running Tests

### Prerequisites
1. Start the API server: `dotnet run --project src/BudgetExperiment.Api`
2. Install Playwright browsers (first time only): `pwsh tests/BudgetExperiment.E2E.Tests/bin/Debug/net10.0/playwright.ps1 install`

### Run Tests
```bash
# Run all E2E tests
dotnet test tests/BudgetExperiment.E2E.Tests

# Run specific test class
dotnet test tests/BudgetExperiment.E2E.Tests --filter "FullyQualifiedName~NavigationTests"

# Run with visible browser (headed mode)
HEADED=true dotnet test tests/BudgetExperiment.E2E.Tests
```

---

## Notes

- Tests assume the user is not authenticated (or authentication is bypassed for testing)
- Initial implementation focuses on happy paths; edge cases added iteratively
- Screenshots on failure can be enabled for debugging
- Consider test parallelization strategy for CI/CD

---

## References

- [Playwright for .NET Documentation](https://playwright.dev/dotnet/)
- [xUnit Documentation](https://xunit.net/)
- Manual testing notes from UI debugging sessions
